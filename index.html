<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aviator Predictor Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #eee;
      text-align: center;
      padding: 20px;
      user-select: none;
    }
    #gameContainer {
      max-width: 400px;
      margin: 0 auto;
      background: #333;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 15px #111;
    }
    #multiplier {
      font-size: 64px;
      font-weight: bold;
      margin: 15px 0;
    }
    #status {
      font-size: 14px;
      margin: 12px 0;
      min-height: 50px;
      line-height: 1.4;
    }
    input[type=number] {
      width: 100px;
      font-size: 18px;
      padding: 6px;
      border-radius: 6px;
      border: none;
      text-align: center;
      margin-bottom: 10px;
    }
    button {
      background-color: #27ae60;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px 0;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    button:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
    #balance {
      font-weight: bold;
      margin-top: 10px;
      font-size: 20px;
    }
    canvas {
      margin-top: 15px;
      background: #111;
      border-radius: 8px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #musicToggle {
      margin-top: 15px;
      background: #3498db;
      width: 100%;
      border-radius: 8px;
      font-size: 16px;
      padding: 8px;
    }

    /* Bounce effect on multiplier */
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    .bounce {
      animation: bounce 0.3s ease-in-out;
    }

    /* Flash background colors */
    .flash-green {
      background-color: #27ae60;
      color: #d0f0d8;
      animation: flash 0.6s ease forwards;
      border-radius: 8px;
      padding: 10px;
    }

    .flash-red {
      background-color: #c0392b;
      color: #f9d6d5;
      animation: flash 0.6s ease forwards;
      border-radius: 8px;
      padding: 10px;
    }

    @keyframes flash {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <h1>Aviator Predictor</h1>
    <div id="balance">Balance: $100.00</div>

    <input type="number" id="betInput" placeholder="Enter your bet" min="1" step="0.01" />
    <br />
    <button id="startBtn">Start Game</button>
    <button id="cashOutBtn" disabled>Cash Out</button>
    <br />

    <label>
      <input type="checkbox" id="autoCashoutToggle" /> Auto Cash Out at
    </label>
    <input type="number" id="autoCashoutValue" placeholder="e.g. 2.5" min="1.01" step="0.01" style="width: 70px;" />
    <br />

    <div id="multiplier">1.00x</div>
    <div id="status"></div>

    <canvas id="graph" width="350" height="100"></canvas>

    <button id="musicToggle">🔈 Play Music</button>
    <audio id="bgMusic" loop src="https://cdn.pixabay.com/download/audio/2021/09/23/audio_4c37f1939a.mp3?filename=calm-electronic-music-1176.mp3"></audio>
  </div>

  <script>
    // Initial variables
    let balance = 100.0;
    let multiplier = 1.0;
    let crashPoint = 0;
    let inGame = false;
    let gameInterval = null;
    let serverSeed = "";
    let roundNumber = 1;
    let graphData = [];

    const balanceEl = document.getElementById("balance");
    const multiplierEl = document.getElementById("multiplier");
    const statusEl = document.getElementById("status");
    const betInput = document.getElementById("betInput");
    const startBtn = document.getElementById("startBtn");
    const cashOutBtn = document.getElementById("cashOutBtn");
    const autoCashoutToggle = document.getElementById("autoCashoutToggle");
    const autoCashoutValue = document.getElementById("autoCashoutValue");
    const canvas = document.getElementById("graph");
    const ctx = canvas.getContext("2d");
    const bgMusic = document.getElementById("bgMusic");
    const musicToggle = document.getElementById("musicToggle");

    const soundStart = new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg");
    const soundCashout = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
    const soundCrash = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

    function playSound(sound) {
      sound.currentTime = 0;
      sound.play();
    }

    // Simple SHA256 using subtle crypto API
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // Generate random server seed (simple random string)
    function generateServerSeed() {
      return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    }

    // Get crash multiplier from hash and round number (simplified pseudo RNG)
    function getCrashFromHash(serverSeed, round) {
      const combined = serverSeed + round;
      let hash = 0;
      for(let i = 0; i < combined.length; i++) {
        hash = ((hash << 5) - hash) + combined.charCodeAt(i);
        hash |= 0; // Convert to 32bit int
      }
      let crash = Math.abs(hash % 1000) / 100 + 1;
      if (crash < 1.1) crash = 1.1;
      if (crash > 10) crash = 10;
      return parseFloat(crash.toFixed(2));
    }

    // Draw the multiplier graph
    function drawGraph() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.strokeStyle = "#27ae60";
      ctx.lineWidth = 2;
      for(let i = 0; i < graphData.length; i++) {
        let x = (i / graphData.length) * canvas.width;
        let y = canvas.height - graphData[i];
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
    }

    // Animate multiplier bounce
    function animateMultiplier() {
      multiplierEl.classList.add("bounce");
      setTimeout(() => {
        multiplierEl.classList.remove("bounce");
      }, 300);
    }

    // Flash status color
    function flashStatus(color) {
      if(color === 'green') {
        statusEl.classList.add("flash-green");
        setTimeout(() => statusEl.classList.remove("flash-green"), 600);
      } else if(color === 'red') {
        statusEl.classList.add("flash-red");
        setTimeout(() => statusEl.classList.remove("flash-red"), 600);
      }
    }

    // Start the game
    async function startGame() {
      const bet = parseFloat(betInput.value);
      if (isNaN(bet) || bet > balance || bet <= 0) {
        alert("Invalid bet amount.");
        return;
      }

      playSound(soundStart);

      serverSeed = generateServerSeed();
      crashPoint = getCrashFromHash(serverSeed, roundNumber);

      multiplier = 1.0;
      inGame = true;
      graphData = [];
      balance -= bet;
      updateBalance();
      startBtn.disabled = true;
      cashOutBtn.disabled = false;

      statusEl.innerHTML = `Game started!<br>🔐 Hash: ${await sha256(serverSeed + roundNumber).then(h => h.substring(0, 12) + "...")}`;

      gameInterval = setInterval(() => {
        multiplier = (parseFloat(multiplier) + 0.01 + multiplier * 0.005).toFixed(2);
        multiplierEl.textContent = multiplier + "x";

        animateMultiplier();

        const yValue = Math.min(canvas.height, multiplier * 8);
        graphData.push(yValue);
        drawGraph();

        if (autoCashoutToggle.checked) {
          let target = parseFloat(autoCashoutValue.value);
          if (!isNaN(target) && multiplier >= target) {
            cashOut();
          }
        }

        if (parseFloat(multiplier) >= crashPoint) {
          crash();
        }
      }, 100);
    }

    // Cash out
    function cashOut() {
      if (!inGame) return;
      clearInterval(gameInterval);
      const bet = parseFloat(betInput.value);
      const winnings = (bet * multiplier).toFixed(2);
      balance += parseFloat(winnings);
      updateBalance();
      statusEl.innerHTML = `✅ Cashed out at ${multiplier}x! Won $${winnings}<br>🔓 Seed: ${serverSeed}<br>🧮 Crash at ${crashPoint}x`;

      playSound(soundCashout);
      flashStatus('green');

      roundNumber++;
      resetGame();
    }

    // Crash event
    function crash() {
      clearInterval(gameInterval);
      statusEl.innerHTML = `💥 Crashed at ${crashPoint}x! You lost.<br>🔓 Seed: ${serverSeed}<br>🧮 Crash verified from hash.`;

      playSound(soundCrash);
      flashStatus('red');

      roundNumber++;
      resetGame();
    }

    // Reset the game UI
    function resetGame() {
      inGame = false;
      startBtn.disabled = false;
      cashOutBtn.disabled = true;
      multiplier = 1.0;
      multiplierEl.textContent = "1.00x";
    }

    // Update balance display
    function updateBalance() {
      balanceEl.textContent = "Balance: $" + balance.toFixed(2);
    }

    // Background music toggle
    let musicPlaying = false;
    musicToggle.addEventListener("click", () => {
      if (!musicPlaying) {
        bgMusic.volume = 0.15;
        bgMusic.play();
        musicToggle.textContent = "🔇 Pause Music";
        musicPlaying = true;
      } else {
        bgMusic.pause();
        musicToggle.textContent = "🔈 Play Music";
        musicPlaying = false;
      }
    });

    // Button event listeners
    startBtn.addEventListener("click", startGame);
    cashOutBtn.addEventListener("click", cashOut);

    // Initialize
    updateBalance();
  </script>
</body>
</html>
